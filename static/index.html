<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <title>Chat</title>
</head>
<body>
<div class="chat-container">
  <ul id="messages">
    <!-- 보내는 사람 구분 하기 -->
    <!-- 내가 보낸거랑, 남이 보낸거   -->
    <li class="message other-message"><strong>가이드</strong>: 안녕! 어떻게 도와줄까요?</li>
    <li class="message user-message">안녕하세요! 문의 사항이 있어서요.</li>

  </ul>

  <form class="input-container" id="chat-form">
    <input type="text" class="input-box" placeholder="메시지를 입력하세요" id="chat-text">
    <button class="send-button">전송</button>
  </form>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script>
  $(function () {
    var scheme = window.location.protocol == "https:" ? 'wss://' : 'ws://';
    var webSocketUri = scheme
            + window.location.hostname
            + (location.port ? ':' + location.port : '')
            + '/ws';

    function log(text, isMe) {
      if (isMe === true) {
        $('#messages').append(`<li class="message user-message"> ${text}</li>`);
      }else {
        $('#messages').append(`<li class="message other-message"><strong>사용자이름</strong>: ${text}</li>`);
      }
    }

    var websocket = new WebSocket(webSocketUri);

    /*websocket.onopen = function () {
      log('Connected');
    };
    websocket.onclose = function () {
      log('Closed');
    };*/

    websocket.onmessage = function (e) {
      log(e.data ,true)
    };
    websocket.onerror = function (e) {
      log('에러 발생');
      console.log(e);
    };

    $('#chat-form').submit(function (e) {
      e.preventDefault();
      var data = $('#chat-text').val();
      if (data) {
        websocket.send(data);
        window.scrollTo(0, document.body.scrollHeight)
        $('#chat-text').val('');
      }
    });

    var userName = prompt('이름을 입력해주세요', '');
    // Rest API 요청보내기
  });
</script>
</body>
</html>
